<div class="login-container">
  <form [formGroup]="form" (ngSubmit)="submit()" novalidate>
    <h1>Login</h1>

    <!-- Global error message -->
    @if (errorMessage()) {
      <div class="error-banner" role="alert" aria-live="polite">
        {{ errorMessage() }}
      </div>
    }

    <!-- Email -->
    <div class="form-field">
      <label for="email">Email</label>
      <input
        id="email"
        type="email"
        formControlName="email"
        [attr.aria-invalid]="isEmailInvalid()"
        [attr.aria-describedby]="isEmailInvalid() ? 'email-error' : null"
        autocomplete="email"
      />
      @if (isEmailInvalid()) {
        <small id="email-error" class="error" role="alert">
          @if (emailControl().errors?.['required']) {
            Email is required.
          } @else if (emailControl().errors?.['email']) {
            Please enter a valid email address.
          }
        </small>
      }
    </div>

    <!-- Password -->
    <div class="form-field">
      <label for="password">Password</label>
      <div class="password-input">
        <input
          id="password"
          [type]="showPassword() ? 'text' : 'password'"
          formControlName="password"
          [attr.aria-invalid]="isPasswordInvalid()"
          [attr.aria-describedby]="isPasswordInvalid() ? 'password-error' : null"
          autocomplete="current-password"
        />
        <button 
          type="button" 
          class="toggle-visibility"
          (click)="togglePasswordVisibility()"
          [attr.aria-label]="showPassword() ? 'Hide password' : 'Show password'"
        >
          {{ showPassword() ? 'ğŸ‘ï¸' : 'ğŸ‘ï¸â€ğŸ—¨ï¸' }}
        </button>
      </div>
      @if (isPasswordInvalid()) {
        <small id="password-error" class="error" role="alert">
          @if (passwordControl().errors?.['required']) {
            Password is required.
          } @else if (passwordControl().errors?.['minlength']) {
            Password must be at least 8 characters.
          }
        </small>
      }
    </div>

    <!-- Submit -->
    <button 
      type="submit" 
      [disabled]="submitting()"
      [attr.aria-busy]="submitting()"
    >
      {{ submitting() ? 'Signing in...' : 'Login' }}
    </button>

    <p class="register-link">
      Don't have an account? <a routerLink="/register">Create one</a>
    </p>
  </form>
</div>