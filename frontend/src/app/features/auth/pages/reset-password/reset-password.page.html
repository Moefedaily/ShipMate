<div class="auth-page">
  <div class="auth-card">

    @if (!success()) {
      <p class="auth-subtitle">
        Choose a new password for your account
      </p>

      <!-- Global error -->
      @if (errorMessage()) {
        <div class="error-banner" role="alert">
          {{ errorMessage() }}
        </div>
      }

      <form [formGroup]="form" (ngSubmit)="submit()" novalidate>

        <!-- New password -->
        <div class="form-field">
          <label for="password">New password</label>

          <div class="password-input">
            <input
              id="password"
              [type]="showPassword() ? 'text' : 'password'"
              formControlName="password"
              autocomplete="new-password"
            />
            <button
              type="button"
              class="password-toggle"
              (click)="togglePasswordVisibility()"
            >
              {{ showPassword() ? 'Hide' : 'Show' }}
            </button>
          </div>

          <small class="hint">
            At least 8 characters with uppercase, lowercase, and number.
          </small>

          @if (isPasswordInvalid()) {
            <small class="error">Password is too weak.</small>
          }
        </div>

        <!-- Confirm password -->
        <div class="form-field">
          <label for="confirmPassword">Confirm password</label>

          <div class="password-input">
            <input
              id="confirmPassword"
              [type]="showConfirmPassword() ? 'text' : 'password'"
              formControlName="confirmPassword"
              autocomplete="new-password"
            />
            <button
              type="button"
              class="password-toggle"
              (click)="toggleConfirmPasswordVisibility()"
            >
              {{ showConfirmPassword() ? 'Hide' : 'Show' }}
            </button>
          </div>

          @if (hasPasswordMismatch()) {
            <small class="error">Passwords do not match.</small>
          }
        </div>

        <!-- Submit -->
        <button
          type="submit"
          class="btn btn--primary auth-submit"
          [disabled]="submitting()"
        >
          {{ submitting() ? 'Updating…' : 'Update password' }}
        </button>
      </form>

      <div class="auth-footer">
        Remember your password?
        <a routerLink="/login">Sign in</a>
      </div>
    }

    <!-- SUCCESS -->
    @if (success()) {
      <div class="auth-success">
        <div class="success-icon">✓</div>
        <h2>Password updated</h2>
        <p>You can now log in using your new password.</p>

        <button
          class="btn btn--primary"
          (click)="navigateToLogin()"
        >
          Go to login
        </button>
      </div>
    }

  </div>
</div>
