<div class="shipment-detail-page">
  <!-- HEADER -->
  <div class="dashboard-hero detail-header">
    <div class="header-left">
      <button class="btn btn--ghost back-btn" (click)="goBack()">
        <mat-icon>arrow_back</mat-icon>
        Back
      </button>
      <div>
        <h1>Shipment details</h1>
        <p>
          Status: 
          <span 
            class="status-badge"
            [ngClass]="{
              'status-created': shipment()?.status === 'CREATED',
              'status-assigned': shipment()?.status === 'ASSIGNED',
              'status-in-transit': shipment()?.status === 'IN_TRANSIT',
              'status-delivered': shipment()?.status === 'DELIVERED',
              'status-cancelled': shipment()?.status === 'CANCELLED'
            }"
          >
            <span class="dot"></span>
            {{ shipment()?.status }}
          </span>
        </p>
      </div>
    </div>
  </div>

  <!-- MAIN CONTENT CARD -->
  <section class="card shipment-detail-card">
    <div class="content">
      
      <!-- LEFT: INFO SECTION -->
      <div class="info">
        
        <!-- PICKUP ADDRESS -->
        <div class="info-block">
          <label>
            <mat-icon>store</mat-icon>
            Pickup Location
          </label>
          <strong>{{ shipment()?.pickupAddress }}</strong>
        </div>

        <!-- DELIVERY ADDRESS -->
        <div class="info-block">
          <label>
            <mat-icon>location_on</mat-icon>
            Delivery Location
          </label>
          <strong>{{ shipment()?.deliveryAddress }}</strong>
        </div>

        <!-- WEIGHT & VALUE -->
        <div class="info-row">
          <div>
            <label>
              <mat-icon>fitness_center</mat-icon>
              Weight
            </label>
            <strong>{{ shipment()?.packageWeight }} kg</strong>
          </div>
          <div>
            <label>
              <mat-icon>payments</mat-icon>
              Declared Value
            </label>
            <strong>{{ shipment()?.packageValue | currency }}</strong>
          </div>
        </div>

        <!-- DATES -->
        <div class="info-row">
          <div>
            <label>
              <mat-icon>calendar_today</mat-icon>
              Pickup Date
            </label>
            <strong>{{ shipment()?.requestedPickupDate | date:'mediumDate' }}</strong>
          </div>
          <div>
            <label>
              <mat-icon>event</mat-icon>
              Delivery Date
            </label>
            <strong>{{ shipment()?.requestedDeliveryDate | date:'mediumDate' }}</strong>
          </div>
        </div>

        <!-- PACKAGE DESCRIPTION (OPTIONAL) -->
        @if (shipment()?.packageDescription) {
          <div class="info-block">
            <label>
              <mat-icon>description</mat-icon>
              Package Description
            </label>
            <strong>{{ shipment()?.packageDescription }}</strong>
          </div>
        }

        <!-- ASSIGNED DRIVER -->
        @if (shipment()?.driver) {
          <div class="assigned-driver">
            <div class="driver-avatar">
              <img 
                *ngIf="shipment()?.driver?.avatarUrl"
                [src]="shipment()?.driver?.avatarUrl"
                [alt]="shipment()?.driver?.firstName"
              />
              <mat-icon *ngIf="!shipment()?.driver?.avatarUrl">person</mat-icon>
            </div>
            <div>
              <span class="label">Assigned Driver</span>
              <strong>{{ shipment()?.driver?.firstName }} {{ shipment()?.driver?.lastName }}</strong>
            </div>
            <span class="vehicle">
              <mat-icon>directions_car</mat-icon>
              {{ shipment()?.driver?.vehicleType }}
            </span>
          </div>
        }

        <!-- ACTIONS -->
        @if (shipment()?.status === 'CREATED') {
          <button
            class="btn btn--primary"
            (click)="editShipment()"
          >
            <mat-icon>edit</mat-icon>
            Edit shipment
          </button>
        }
        
      </div>

      <!-- RIGHT: MAP -->
      <div class="map">
        <app-leaflet-map
          mode="route"
          [stops]="mapStops()"
          [showLegend]="false"
        />
      </div>

    </div>
  </section>

  <!-- PHOTOS SECTION (OPTIONAL - if shipment has photos) -->
    @if (shipment()?.photos?.length) {
      
    <section class="card shipment-detail-card detail-section">
      <h3>
        <mat-icon>photo_library</mat-icon>
        Package Photos
      </h3>
      <div class="photo-grid">
        @for (photo of shipment()?.photos; track photo) {
          <img [src]="photo" [alt]="'Package photo ' + ($index + 1)" />
        }
      </div>
    </section>
  }

</div>